- name: ensure my desired shell exists
  shell: grep {{ myshell }} /etc/shells | head -n1
  register: shell_result
- debug: var=shell_result.stdout

- name: set shell
  set_fact:
    shell_fact: "{{ myshell }}"

- name: set shell
  set_fact:
    shell_fact: /bin/csh
  when: shell_result.stdout | select('search','{{ myshell }}') | list | count < 0

- name: get the next uid
  shell: echo $(grep people /etc/passwd | cut -d':' -f3 | sort -n | tail -n1)+1 | bc
  register: next_uid
- debug: var=next_uid.stdout

- name: Create my user
  shell: /usr/sysadm/privbin/addUserAccount -l {{ myuser }} -u {{ next_uid.stdout }} -g 20 -C -H /usr/people/{{ myuser }} -S {{ myshell }}

- name: Set password
  shell: echo "{{ mypw }}" | /usr/sysadm/privbin/modifyAccountPassword -l {{ myuser }} -P

- name: Create didbs_sshd group
  telnet:
    user: root
    password: 
    login_prompt: "login: "
    prompts:
      - "[>|#]"
    command:
      - echo "sshd::23:sshd" >> /etc/group

- name: Create didbs_sshd user
  telnet:
    user: root
    password: 
    login_prompt: "login: "
    prompts:
      - "[>|#]"
    command:
      - /usr/sysadm/privbin/addUserAccount -l sshd -u 23 -g 23 -H /dev/null -S /dev/null

- name: Check if key exists
  telnet:
    user: root
    password:
    login_prompt: "login: "
    prompts:
      - "[>|#]"
    command:
      - find /usr/didbs/etc/ssh_host_ecdsa_key -type f
  register: keyname

- name: Create etc
  file:
    path: /usr/didbs/etc
    state: directory

- name: Create didbs_ssh keys
  telnet:
    user: root
    password:
    login_prompt: "login: "
    prompts:
      - "[>|#]"
    command:
      - /usr/didbs/bin/ssh-keygen -f /usr/didbs/etc/ssh_host_ecdsa_key -q -N ""

- name: Copy didbs_sshd init
  copy:
    src: files/didbs_sshd
    dest: /etc/init.d/didbs_sshd

- name: Start didbs_sshd at bootup with chkconfig
  telnet:
    user: root
    password: 
    login_prompt: "login: "
    prompts:
      - "[>|#]"
    command:
      - chkconfig didbs_sshd on

- name: Start didbs_sshd
  telnet:
    user: root
    password: 
    login_prompt: "login: "
    prompts:
      - "[>|#]"
    command:
      - /etc/init.d/didbs_sshd start

